<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Capataz-Dash | Control de Producción</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="css/styles.css" rel="stylesheet">
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Icons -->
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0,0" />
    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        zinc: { 950: '#09090b' },
                        neon: {
                            cyan: '#06b6d4',
                            violet: '#8b5cf6',
                            lime: '#84cc16'
                        }
                    }
                }
            }
        }
    </script>
</head>

<body class="bg-zinc-950 text-white font-inter selection:bg-neon-cyan selection:text-black">

    <!-- Top Bar -->
    <header
        class="fixed top-0 w-full z-50 h-[70px] glass-card border-b border-white/10 flex items-center justify-between px-6">
        <!-- Logo Area -->
        <div class="flex items-center gap-4">
            <div class="relative h-10 w-auto min-w-[40px] flex items-center">
                <!-- LOGO.PNG goes here -->
                <img src="logo.png" alt="Empresa Logo" class="h-10 object-contain hover:scale-105 transition-transform">
            </div>
            <div class="h-6 w-px bg-white/10 mx-2"></div>
            <h2 class="text-xl font-bold tracking-tight">Capataz<span class="text-neon-cyan">Dash</span></h2>
        </div>

        <!-- Filters -->
        <div class="flex items-center gap-3">
            <!-- Date Filter -->
            <div class="relative group">
                <span
                    class="material-symbols-rounded absolute left-3 top-2.5 text-zinc-400 group-hover:text-neon-violet transition-colors text-[20px]">calendar_today</span>
                <input type="month"
                    class="pl-10 pr-4 py-2 rounded-full glass-input text-sm w-36 focus:w-40 transition-all cursor-pointer"
                    id="filter-date">
            </div>

            <!-- SKU Filter -->
            <div class="relative group">
                <span
                    class="material-symbols-rounded absolute left-3 top-2.5 text-zinc-400 group-hover:text-neon-cyan transition-colors text-[20px]">qr_code_2</span>
                <input list="sku-list" placeholder="SKU / Art."
                    class="pl-10 pr-4 py-2 rounded-full glass-input text-sm w-32 focus:w-40 transition-all"
                    id="filter-sku">
                <datalist id="sku-list">
                    <!-- Populated by JS -->
                </datalist>
            </div>

            <!-- Familia Filter -->
            <div class="relative group">
                <span
                    class="material-symbols-rounded absolute left-3 top-2.5 text-zinc-400 group-hover:text-neon-cyan transition-colors text-[20px]">category</span>
                <select
                    class="pl-10 pr-8 py-2 rounded-full glass-input text-sm appearance-none cursor-pointer w-28 focus:w-36 transition-all"
                    id="filter-familia">
                    <option value="all">Familia</option>
                    <!-- Populated by JS -->
                </select>
            </div>

            <!-- Molde Filter -->
            <div class="relative group hidden lg:block">
                <span
                    class="material-symbols-rounded absolute left-3 top-2.5 text-zinc-400 group-hover:text-neon-cyan transition-colors text-[20px]">view_in_ar</span>
                <select
                    class="pl-10 pr-8 py-2 rounded-full glass-input text-sm appearance-none cursor-pointer w-28 focus:w-36 transition-all"
                    id="filter-molde">
                    <option value="all">Molde</option>
                    <!-- Populated by JS -->
                </select>
            </div>

            <!-- Linea Filter -->
            <div class="relative group">
                <span
                    class="material-symbols-rounded absolute left-3 top-2.5 text-zinc-400 group-hover:text-neon-cyan transition-colors text-[20px]">precision_manufacturing</span>
                <select
                    class="pl-10 pr-8 py-2 rounded-full glass-input text-sm appearance-none cursor-pointer hover:bg-white/5 transition-colors"
                    id="filter-line">
                    <option value="all">Línea</option>
                    <option value="L1">Línea 1</option>
                    <option value="L2">Línea 2</option>
                    <option value="L3">Línea 3</option>
                </select>
            </div>
        </div>

        <!-- User & Actions -->
        <div class="flex items-center gap-4">
            <button onclick="exportData()"
                class="flex items-center gap-2 px-4 py-2 rounded-full bg-white/5 hover:bg-neon-cyan/20 border border-white/10 hover:border-neon-cyan/50 text-sm font-medium transition-all group">
                <span class="material-symbols-rounded text-zinc-400 group-hover:text-neon-cyan">download</span>
                <span class="hidden md:inline">Exportar</span>
            </button>

            <button id="logout-btn" class="p-2 rounded-full hover:bg-red-500/20 hover:text-red-400 transition-colors"
                title="Cerrar Sesión">
                <span class="material-symbols-rounded">logout</span>
            </button>
        </div>
    </header>

    <!-- Main Content (Hidden by default until Auth) -->
    <main id="app-content" style="display: none;" class="pt-[90px] px-6 pb-8 max-w-[1600px] mx-auto space-y-6">

        <!-- KPI Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
            <!-- KPI 1 -->
            <div class="glass-card p-6 rounded-2xl relative overflow-hidden group">
                <div
                    class="absolute -right-6 -top-6 w-24 h-24 bg-neon-cyan/10 rounded-full blur-xl group-hover:bg-neon-cyan/20 transition-all">
                </div>
                <h3 class="text-zinc-400 text-sm font-medium uppercase tracking-wider mb-2">Avance Planificado</h3>
                <div class="flex items-end gap-2">
                    <span class="text-3xl font-bold text-white" id="kpi-plan">0</span>
                    <span class="text-sm text-zinc-500 mb-1">u.</span>
                </div>
                <div class="mt-2 text-xs text-neon-cyan font-medium">100% Objetivo</div>
            </div>

            <!-- KPI 2 -->
            <div class="glass-card p-6 rounded-2xl relative overflow-hidden group">
                <div
                    class="absolute -right-6 -top-6 w-24 h-24 bg-neon-violet/10 rounded-full blur-xl group-hover:bg-neon-violet/20 transition-all">
                </div>
                <h3 class="text-zinc-400 text-sm font-medium uppercase tracking-wider mb-2">Producción Real</h3>
                <div class="flex items-end gap-2">
                    <span class="text-3xl font-bold text-white" id="kpi-real">0</span>
                    <span class="text-sm text-zinc-500 mb-1">u.</span>
                </div>
                <!-- Dynamic color logic in JS -->
                <div class="mt-2 text-xs text-red-400 font-medium" id="kpi-real-delta">▼ 0% vs Plan</div>
            </div>

            <!-- KPI 3: TIEMPO ATRASO (CORE) -->
            <div class="glass-card p-6 rounded-2xl relative overflow-hidden group border-l-4 border-l-transparent transition-all"
                id="kpi-card-delay">
                <div class="absolute -right-6 -top-6 w-24 h-24 bg-orange-500/10 rounded-full blur-xl transition-all">
                </div>
                <h3 class="text-zinc-400 text-sm font-medium uppercase tracking-wider mb-2">Tiempo de Atraso</h3>
                <div class="flex items-end gap-2">
                    <span class="text-3xl font-bold text-white" id="kpi-delay">0</span>
                    <span class="text-sm text-zinc-500 mb-1">días</span>
                </div>
                <div class="mt-2 text-xs text-zinc-400">Ritmo: <span id="kpi-ritmo" class="text-white">0</span> u/día
                </div>
            </div>

            <!-- KPI 4: FIN ESTIMADO -->
            <div class="glass-card p-6 rounded-2xl relative overflow-hidden group">
                <div
                    class="absolute -right-6 -top-6 w-24 h-24 bg-neon-lime/10 rounded-full blur-xl group-hover:bg-neon-lime/20 transition-all">
                </div>
                <h3 class="text-zinc-400 text-sm font-medium uppercase tracking-wider mb-2">Fin Estimado</h3>
                <div class="text-2xl font-bold text-white truncate" id="kpi-end-date">--/--/----</div>
                <div class="mt-2 text-xs text-neon-lime font-medium">Proyección Inteligente</div>
            </div>
        </div>

        <!-- Charts Area -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 h-[500px]">
            <!-- Main Chart: Curva S -->
            <div class="lg:col-span-2 glass-card p-6 rounded-2xl flex flex-col">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-lg font-semibold flex items-center gap-2">
                        <span class="w-2 h-2 rounded-full bg-neon-cyan"></span>
                        Avance Acumulado (Curva S)
                    </h3>
                    <div class="flex bg-white/5 rounded-lg p-1 border border-white/10 gap-1">
                        <button onclick="setGranularity('day')"
                            class="px-3 py-1 rounded text-xs font-medium hover:bg-white/10 transition-colors text-white granularity-btn active"
                            data-g="day">Día</button>
                        <button onclick="setGranularity('week')"
                            class="px-3 py-1 rounded text-xs font-medium hover:bg-white/10 transition-colors text-zinc-400 granularity-btn"
                            data-g="week">Sem</button>
                        <button onclick="setGranularity('month')"
                            class="px-3 py-1 rounded text-xs font-medium hover:bg-white/10 transition-colors text-zinc-400 granularity-btn"
                            data-g="month">Mes</button>
                    </div>
                </div>
                <div class="flex-1 relative w-full h-full min-h-0">
                    <canvas id="chart-curve"></canvas>
                </div>
            </div>

            <!-- Secondary Chart: Barras Diarias -->
            <div class="glass-card p-6 rounded-2xl flex flex-col">
                <h3 class="text-lg font-semibold mb-6 flex items-center gap-2">
                    <span class="w-2 h-2 rounded-full bg-neon-violet"></span>
                    Producción Diaria
                </h3>
                <div class="flex-1 relative w-full h-full min-h-0">
                    <canvas id="chart-bar"></canvas>
                </div>
            </div>
        </div>

    </main>

    <script src="js/auth.js"></script>
    <script src="js/app.js"></script>
</body>

</html>